# Архитектура

Этот документ описывает архитектурный дизайн приложения Remote Transmission Desktop Client.

## Обзор

Remote Transmission Desktop Client следует принципам Чистой архитектуры (Clean Architecture), с четким разделением обязанностей между различными слоями приложения. Архитектура разработана для обеспечения удобного сопровождения, тестирования и гибкости.

## Архитектурные слои

Приложение организовано в следующие слои:

### 1. Доменный слой

Доменный слой содержит основную бизнес-логику и сущности приложения. Он не зависит от других слоев и фреймворков.

**Ключевые компоненты:**
- `domain/torrent.go`: Определяет модель Torrent и связанные интерфейсы
- `domain/config.go`: Сущности конфигурации
- `domain/session_stats.go`: Сущности статистики сессии

Доменный слой определяет интерфейсы, которые реализуются инфраструктурным слоем, следуя Принципу инверсии зависимостей.

### 2. Слой приложения

Слой приложения оркестрирует поток данных между доменным и инфраструктурным слоями. Он содержит варианты использования приложения.

**Ключевые компоненты:**
- `application/torrent_service.go`: Сервис для управления торрентами и реализации бизнес-правил
- Управление соединением с автоматическим переподключением и обработкой таймаутов

Этот слой координирует работу доменных сущностей и инфраструктурных сервисов для выполнения конкретных задач, таких как добавление торрентов, управление путями загрузки, контроль рейтинга загрузки и обработка проблем с соединением.

### 3. Инфраструктурный слой

Инфраструктурный слой реализует интерфейсы, определенные в доменном слое. Он содержит конкретные реализации для внешних сервисов и технологий.

**Ключевые компоненты:**
- `infrastructure/transmission_client.go`: Реализация клиента API Transmission
- `infrastructure/config_service.go`: Сервис управления конфигурацией
- `infrastructure/localization_service.go`: Сервис локализации
- `infrastructure/encryption_service.go`: Сервис для безопасного хранения конфиденциальных данных

### 4. Слой пользовательского интерфейса

Слой пользовательского интерфейса управляет логикой представления и взаимодействием с пользователем. В этом приложении он состоит из:

- **Интеграция бэкенда с UI**: `app.go` служит мостом между бэкендом Go и фронтендом React
- **Фронтенд**: Компоненты React в директории `frontend/src`

## Поток данных

Типичный поток данных в приложении следует этим шагам:

1. Пользователь взаимодействует с UI (фронтенд React)
2. UI вызывает методы, предоставляемые `app.go`
3. App делегирует запрос слою сервисов приложения
4. Слой приложения координирует работу с доменным и инфраструктурными слоями
5. Результаты проходят обратно через слои к UI

## Ключевые шаблоны проектирования

В приложении используется несколько шаблонов проектирования:

- **Шаблон Репозиторий**: Абстрагирует доступ к данным через интерфейс `TorrentRepository`
- **Шаблон Сервис**: Сервисы приложения инкапсулируют бизнес-логику
- **Внедрение зависимостей**: Зависимости предоставляются компонентам, а не создаются внутри них
- **Context API (React)**: Для управления состоянием во фронтенде

## Структура директорий

```
├── app.go                  # Слой интеграции UI
├── main.go                 # Точка входа
├── internal/
│   ├── application/        # Сервисы приложения
│   │   └── torrent_service.go
│   ├── domain/             # Доменные модели и интерфейсы
│   │   ├── config.go
│   │   ├── session_stats.go
│   │   └── torrent.go
│   └── infrastructure/     # Реализация внешних сервисов
│       ├── config_service.go
│       ├── encryption_service.go
│       ├── localization_service.go
│       └── transmission_client.go
├── frontend/               # Компоненты UI React
│   └── src/
│       ├── components/     # UI компоненты
│       ├── contexts/       # React контексты для управления состоянием
│       ├── hooks/          # Пользовательские React хуки
│       └── types/          # TypeScript типы
└── locales/                # Файлы локализации
    ├── en.json
    └── ru.json
```

## Архитектура фронтенда

Фронтенд следует компонентной архитектуре с использованием React и TypeScript:

- **Компоненты**: Повторно используемые UI компоненты в `frontend/src/components`
- **Контексты**: React Context API для управления состоянием в `frontend/src/contexts`
- **Пользовательские хуки**: Общая логика и управление состоянием в `frontend/src/hooks`
- **CSS Modules**: Ограниченные стили для компонентов

## Коммуникация между фронтендом и бэкендом

Коммуникация между фронтендом React и бэкендом Go осуществляется с помощью фреймворка Wails:

1. Функции Go предоставляются через параметр `Bind` в `main.go`
2. TypeScript-привязки генерируются в `frontend/wailsjs/go/`
3. Компоненты фронтенда вызывают эти привязки для выполнения функций Go

## Обработка ошибок

В приложении реализована комплексная стратегия обработки ошибок:

- Доменные ошибки определяются в доменном слое
- Инфраструктурные ошибки преобразуются в доменные ошибки при необходимости
- Сервисы приложения обрабатывают и переводят ошибки для UI
- Локализованные сообщения об ошибках предоставляются пользователю

## Управление конфигурацией

Конфигурация управляется через:

- Локальное хранилище для пользовательских настроек
- Безопасное хранилище для конфиденциальной информации, такой как учетные данные
- Конфигурация времени выполнения для настроек приложения

## Локализация

Приложение поддерживает несколько языков через:

- JSON-файлы перевода в директории `locales`
- Сервис локализации в инфраструктурном слое
- Компоненты React, которые используют переводы через контекст

## Соображения безопасности

- Учетные данные хранятся безопасно с использованием платформенно-специфичного шифрования
- Коммуникация с сервером Transmission использует аутентификацию
- Проверка ввода выполняется на нескольких уровнях